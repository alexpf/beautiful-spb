<html>
<head>
  <meta charset="UTF-8"> 
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" integrity="sha512-WXoSHqw/t26DszhdMhOXOkI7qCiv5QWXhH9R7CgvgZMHz1ImlkVQ3uNsiQKu5wwbbxtPzFXd1hK4tzno2VqhpA==" crossorigin=""></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.0.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://rawgit.com/Leaflet/Leaflet.markercluster/leaflet-0.7/dist/MarkerCluster.Default.css">
  <script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
  <script src='https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster-src.js'></script>  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  
  <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
  
  
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
<link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>

<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

<script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js" integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP" crossorigin="anonymous"></script>
<script src="https://makinacorpus.github.io/Leaflet.Spin/spin/dist/spin.min.js" charset="utf-8"></script>
<script src="https://makinacorpus.github.io/Leaflet.Spin/leaflet.spin.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.1/bootstrap-slider.min.js" charset="utf-8"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.1/css/bootstrap-slider.min.css">
<link rel="stylesheet" href="css/custom.css">
</head>
<body>
  <div id="map">
  <div style="z-index:1001; background: #2e76b0; width: 100%; height: 60px; position: absolute; opacity:0.7">
  </div>
    <div class="btngrp" style="z-index: 1002; left: 4%; top: 10px"> 
      <select id="category-picker">
        <option value="id10">Бюджетное учреждение</option>
        <option value="id6">Водный объект</option>
        <option value="id7">Временное сооружение</option>
        <option value="id2">Двор</option>
        <option value="id1" selected>Дом</option>
        <option value="id5">Квартира</option>
		<option value="id8">Коммерческое строительство</option>
        <option value="id9">Мост</option>
		<option value="id10">Общественный транспорт</option>
		<option value="id16">Объекты для размещения информации</option>
		<option value="id11">Остановка общественного транспорта</option>
		<option value="id4">Парк, сад, бульвар, сквер</option>
        <option value="id20">Рекламные или информационные конструкции</option>
        <option value="id12">Рекламные конструкции</option>
        <option value="id19">Сооружение</option>
		<option value="id13">Строительная площадка</option>
		<option value="id14">Территория Санкт-Петербурга</option>
		<option value="id15">Торговый объект</option>
		<option value="id3">Улица</option>
      </select>
	  </div>

	  <div class="btngrp" style="z-index: 1002; left: 6%; top: 10px">

	    <select id="district-picker">
          <option value="cheese" selected>Адмиралтейский</option>
          <option value="tomatoes">Центральный</option>
          <option value="mozarella">Колпинский</option>
          <option value="mushrooms">Кировский</option>
          <option value="pepperoni">Петроградский</option>
          <option value="onions">Невский</option>
          <option value="onions">Калининский</option>
          <option value="onions">Выборгский</option>
		  <option value="onions">Московский</option>
          <option value="onions">Приморский</option>
          <option value="onions">Василеостровский</option>
          <option value="onions">Красносельский</option>
          <option value="onions">Петродворцовый</option>
          <option value="onions">Пушкинский</option>
          <option value="onions">Красногвардейский</option>
        </select>
      </div>
	  <div class="btngrp" style="z-index: 1002; left: 8%; top: 10px">
	    <input type="text" name="daterange" value="01/01/2018 - 02/03/2018" class="btn" style="width: 250"/>
	  </div>
	  
	<div class="btngrp" style="z-index: 1002; left: 12%; top: 10px;" id="timediv">
       <input id="time" type="text"
          data-provide="slider"
          data-slider-ticks="[0,1,2,3,4]"
          data-slider-min="1"
          data-slider-max="6"
          data-slider-step="1"
          data-slider-value="0"
          data-slider-tooltip="hide" style=" width: 600px" /> 
    </div>
  </div>
 </body>


<script src="js/leaflet_conf.js"></script>

    <!-- Initialize the plugin: -->
    <script type="text/javascript">
        $(document).ready(function() {
            $('#category-picker').multiselect();
            $('#district-picker').multiselect();
            var category = $('#category-picker option:selected').text();
            map.spin(true);
            $.ajax({
                url: "/api/issue/dateRange?category=" + category + "&dateFrom=2018-01-01&dateTo=2018-02-03",
                success: function(data) {
                    map.spin(false);
                    refreshLayerData(data);
                    addMcgLayer();
                },
                error: function() {
                    map.spin(false);
                }
            });
        });

$("#time").on('change', function(data){
			console.log(data);
			alert(periods[data.value.newValue])
		});

$(function() {
  $('input[name="daterange"]').daterangepicker({
    opens: 'left'
  }, function(start, end, label) {
        var dateFrom = start.format('YYYY-MM-DD');
        var dateTo = end.format('YYYY-MM-DD');
		var difference = end.diff(start);
		periods = [];
		for(i = 0; i < 5; i++) {
		  periods.push(start.add(difference / 5 * i))
		}
        console.log("A new date selection was made: " + dateFrom + ' to ' + dateTo);
        var category = $('#category-picker option:selected').text();
          map.spin(true);
          $.ajax({
              url: "/api/issue/dateRange?category=" + category + "&dateFrom=" + dateFrom + "&dateTo=" + dateTo,
              success: function(data) {
                  removeLayers();
                  refreshLayerData(data);
                  map.spin(false);
                  if (currentLayer === 'mcg') {
                      addMcgLayer();
                  }
                  else {
                      addHeatLayer();
                  }
              },
              error: function() {
                  map.spin(false);
              }
          });
  });

    $('#category-picker').change(function(){
        var category = $('#category-picker option:selected').text();
        var dateFrom = $('input[name="daterange"]').data('daterangepicker').startDate.format('YYYY-MM-DD');
        var dateTo = $('input[name="daterange"]').data('daterangepicker').endDate.format('YYYY-MM-DD');
        map.spin(true);
        $.ajax({
            url: "/api/issue/dateRange?category=" + category + "&dateFrom=" + dateFrom + "&dateTo=" + dateTo,
            success: function(data) {
                removeLayers();
                refreshLayerData(data);
                map.spin(false);
                if (currentLayer === 'mcg') {
                    addMcgLayer();
                }
                else {
                    addHeatLayer();
                }
            },
            error: function() {
                map.spin(false);
            }
        });
    });
});
    </script>
</html>